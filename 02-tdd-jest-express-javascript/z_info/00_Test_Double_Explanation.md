
# Test Double คืออะไร?

Test Double คือแนวคิดในวงการทดสอบซอฟต์แวร์ที่ใช้เรียกวัตถุหรือคลาสที่จำลองพฤติกรรมของส่วนต่างๆ ในระบบที่เราต้องการทดสอบ โดยมีจุดประสงค์เพื่อลดความซับซ้อนหรือจัดการกับ dependency ของโค้ดที่เราต้องการทดสอบ ตัวอย่างเช่น การจำลองพฤติกรรมของฐานข้อมูล, การจำลองพฤติกรรมของ API ภายนอก หรือแม้แต่การจำลองพฤติกรรมของฟังก์ชันภายในระบบเอง

## ประเภทของ Test Double
Test Double แบ่งออกได้เป็นหลายประเภท แต่ละประเภทมีลักษณะการทำงานและการใช้งานที่แตกต่างกันไป เช่น:

1. **Dummy**: เป็นวัตถุที่สร้างขึ้นมาเพื่อให้โค้ดทำงานต่อไปได้แต่ไม่ได้มีการใช้งานจริง ๆ ในการทดสอบ ตัวอย่างเช่นการสร้างวัตถุที่จำเป็นสำหรับเป็นพารามิเตอร์ในการเรียกใช้ฟังก์ชัน แต่ไม่ได้ใช้ค่าในวัตถุนั้นในการทดสอบ

2. **Fake**: เป็นวัตถุที่มีการใช้งานจริง แต่มีการทำงานที่เรียบง่ายกว่าสิ่งที่ใช้งานจริง ตัวอย่างเช่น การจำลองฐานข้อมูลในหน่วยความจำสำหรับทดสอบแทนที่จะใช้ฐานข้อมูลจริง

3. **Stub**: เป็นวัตถุที่ใช้ในการควบคุมการส่งคืนข้อมูลเฉพาะกรณีของการทดสอบ ตัวอย่างเช่น การตั้งค่าให้ stub ส่งคืนค่าคงที่เมื่อมีการเรียกใช้ฟังก์ชัน

4. **Spy**: คล้ายกับ stub แต่มีความสามารถเพิ่มเติมในการบันทึกข้อมูลว่าเมธอดหรือฟังก์ชันถูกเรียกกี่ครั้ง และถูกเรียกด้วยพารามิเตอร์ใดบ้าง มักใช้ในการตรวจสอบว่าฟังก์ชันที่เราคาดหวังให้ถูกเรียกทำงานตามที่คาดไว้หรือไม่

5. **Mock**: เป็นวัตถุที่ซับซ้อนที่สุดในการจำลองพฤติกรรมของ Test Double เพราะนอกจากจะสามารถกำหนดค่าการส่งคืนและบันทึกการเรียกใช้ได้แล้ว ยังสามารถตั้งค่าให้ตรวจสอบว่าฟังก์ชันถูกเรียกใช้อย่างไรบ้าง เช่น จำนวนครั้งที่เรียก, ค่าพารามิเตอร์ที่ใช้ เป็นต้น ซึ่งจะมีการตรวจสอบตามที่เรากำหนดไว้

## การเลือกใช้ Test Double
การเลือกใช้ประเภทของ Test Double ขึ้นอยู่กับสถานการณ์ในการทดสอบ เช่น หากต้องการแค่ให้การทดสอบทำงานต่อไปได้ อาจเลือกใช้ Dummy แต่ถ้าต้องการจำลองการเรียกใช้ API ที่ต้องการตรวจสอบจำนวนครั้งที่ถูกเรียก ก็อาจเลือกใช้ Mock หรือ Spy

## ตัวอย่างการใช้งานใน JavaScript ด้วย Jest
ใน Jest ซึ่งเป็นเครื่องมือสำหรับทดสอบโค้ดใน JavaScript นั้น เราสามารถสร้าง Test Double ได้หลายประเภท เช่น:

```javascript
// ตัวอย่างการใช้ Mock ใน Jest
const myMock = jest.fn();
myMock.mockReturnValue(10);

console.log(myMock()); // จะได้ค่า 10

// ตัวอย่างการใช้ Spy ใน Jest
const calculator = {
  add: (a, b) => a + b,
};

const addSpy = jest.spyOn(calculator, 'add');

calculator.add(1, 2);
console.log(addSpy.mock.calls.length); // จะได้ค่า 1 เพราะฟังก์ชัน add ถูกเรียกครั้งหนึ่ง
console.log(addSpy.mock.calls[0]); // จะได้ [1, 2] ซึ่งเป็นพารามิเตอร์ที่ใช้ในการเรียกฟังก์ชันครั้งแรก
```

Test Double เป็นเครื่องมือสำคัญในการทดสอบซอฟต์แวร์เพื่อลดความซับซ้อนและสามารถควบคุมพฤติกรรมของส่วนที่เป็น dependency ได้ ทำให้การทดสอบมีประสิทธิภาพและง่ายต่อการตรวจสอบผลลัพธ์มากขึ้น


